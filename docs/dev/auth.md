# Auth & Security\n\n**Model:** 

JWT access tokens (short-lived) + refresh tokens (rotating, stored as httpOnly cookies).\n\n## Endpoints\n\n- **POST /auth/join** — start join flow; sends a verification link (15m expiry).\n- **POST /auth/login** — exchange credentials for an access token; sets a refresh token cookie.\n- **POST /auth/refresh** — uses refresh cookie to mint a new access token.\n- **POST /auth/logout** — clears the refresh cookie and revokes the token server-side.\n- **POST /auth/request-password-reset** — sends a time-limited reset link.\n- **POST /auth/reset-password** — finalize password reset with the provided token.\n- **GET /auth/me** — returns the authenticated user profile (Authorization header required).\n\n## Token recommendations\n\n- Access token: 10–15 minutes. Include claims: sub, iat, exp, roles.\n- Refresh token: 7–30 days. Store only token hashes in DB for revocation. Rotate refresh tokens on use.\n\n## DB schema (Auth tables)\n\n- users (id UUID, email UNIQUE, password_hash, name, is_verified, created_at, updated_at)\n- refreshTokens (id, user_id, token_hash, expires_at, revoked, created_ip, created_at)\n- email_verifications / password_resets (token_hash, user_id, expires_at, used)\n\n## Implementation notes\n\n- Password hashing: bcrypt (cost=12+) or argon2.\n- JWT signing: strong secret or RSA keypair; support key rotation with `kid`.\n- Middleware: auth.verifyAccessToken -> attaches `req.user`; auth.ensureRole(role) for RBAC.\n- Rate limiting: stricter limits for login & password-reset endpoints.\n- Email: templated transactional email with Message-ID for traceability.\n\n## Frontend flow\n\n- Recommended: store access token in memory (React context). Use a refresh hook to silently call /auth/refresh before expiry. Do not store access tokens in localStorage.\n\n## Tests\n\n- Unit: token creation/verification, hashing, middleware.\n- Integration: verify full register -> verify -> login -> refresh -> logout flows (use a mocked email provider in CI).\n\n## Security checklist\n\n- HTTPS everywhere; secure cookie flags; rate limiting; password policy; time-limited email tokens; CSRF protection where applicable; audit logging for auth events.\n`;